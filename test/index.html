<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>测试页面</title>
    <script src="/test/jquery-1.8.3.min.js"></script>

    <script type="text/javascript" src="http://api.map.baidu.com/api?v=3.0&ak=iwfYuKQm6uTZzuFUneI7KMKhlT6IF6mi">
    </script>

    <!-- 加载百度地图样式信息窗口 -->
    <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.5/src/SearchInfoWindow_min.css" />
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <div style="width:100%; height:100%;" id="map"></div>

    <script>
        // 百度地图API功能
        var map = new BMap.Map("map"); // 创建Map实例

        // map.centerAndZoom("顺德", 12);
        map.centerAndZoom(new BMap.Point(113.300251, 22.810862), 13);



        map.enableScrollWheelZoom(true); //开启鼠标滚轮缩放

        // $.ajax({
        //     url: '/api/pointData',
        //     success: function (res) {
        //         var mapData = new MapData('point', map, res)
        //         mapData.render()
        //     }
        // })

        $.ajax({
            url: 'http://localhost:8080/lapi/data',
            success: function (res) {
                var mapData = new MapData('point', map, res)
                mapData.click(function (item, map) {

                    var point = new BMap.Point(item.lon, item.lat);
                    var marker = new BMap.Marker(point);
                    $.ajax({
                        url: 'http://localhost:8080/mapi/clickData?id='+item.id,
                        type: 'get',
                        success: function (res) {

                            console.log(res)
                            var sContent = res.data.data;
                            var infoWindow = new BMap.InfoWindow(sContent); // 创建信息窗口对象
                            map.openInfoWindow(infoWindow, point); //开启信息窗口

                        }
                    })

                })
                mapData.setImage("https://s1.ax1x.com/2020/04/17/JZku8K.png")
                mapData.render()

            }
        })
    </script>
</body>

</html>